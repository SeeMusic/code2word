# Code2Word 技术说明文档

## 项目架构

### 核心模块

1. **lineCounter.js**
   - 负责代码行数统计
   - 调用 cloc 工具进行统计
   - 处理统计结果并返回标准格式

2. **pickLines.js**
   - 实现智能代码选择算法
   - 使用动态规划确保最优选择
   - 计算文件统计指标

3. **generateDoc.js**
   - 处理文档生成
   - 使用 docx 库创建文档
   - 处理文件读写操作

4. **config/ignore.js**
   - 配置文件过滤规则
   - 支持按文件类型设置规则
   - 管理忽略目录和文件类型

### 工作流程

1. **代码统计**
   - 使用 cloc 工具统计代码行数
   - 获取每个文件的实际代码行数、注释行数和空行数
   - cloc 可以准确识别不同语言的注释格式

2. **文件选择**
   - 基于动态规划算法选择合适的文件组合
   - 目标：找到一组文件，使其实际代码行数总和最接近且不小于指定行数
   - 只计算实际代码行数（不包括注释和空行）
   - 确保文件完整性，不会出现文件被截断的情况

3. **文档生成**
   - 读取选中的文件内容
   - 去除注释和空行
   - 生成格式化的 Word 文档

### 关键算法

#### 动态规划选择算法
```javascript
dp[i][j] = max(dp[i-1][j], dp[i-1][j-files[i-1].code] + files[i-1].code)
```

算法说明：
- i: 当前处理到的文件索引
- j: 当前累计的代码行数（实际代码，不含注释和空行）
- files[i-1].code: 当前文件的实际代码行数
- dp[i][j]: 在前 i 个文件中选择，累计行数不超过 j 时的最优解

选择标准：
1. 总代码行数必须大于等于目标行数
2. 在满足条件 1 的前提下，选择最接近目标行数的组合
3. 保持文件完整性，不截断任何文件

算法复杂度：
- 时间复杂度：O(n * maxLines)
- 空间复杂度：O(n * maxLines)
- n 为文件数量，maxLines 为目标行数

#### 文件统计实现
- 使用 cloc 工具进行基础统计
- 通过 child_process 调用系统命令
- 结果解析和数据标准化

## 开发指南

### 环境配置
- Node.js >= 20.10.0
- 依赖管理：推荐使用 pnpm
- 开发工具：建议使用支持 ESLint 的编辑器

### 代码规范
- 使用 ES6+ 语法
- 遵循模块化原则
- 保持函数单一职责
- 添加必要的注释和文档

### 测试策略
- 单元测试：待添加
- 集成测试：待添加
- 性能测试：待添加

## 性能优化

### 当前性能瓶颈
1. 大文件处理
2. 动态规划算法在文件数量大时的性能
3. Word 文档生成的内存占用

### 优化方向
1. 文件读取流式处理
2. 算法优化和剪枝
3. 文档生成的内存管理

## 已知问题

1. 大文件处理可能导致内存溢出
2. 特殊字符处理不完善
3. 缺乏进度提示

## 未来规划

### 短期目标
1. 完善错误处理
2. 添加日志系统
3. 优化性能瓶颈
4. 添加单元测试

### 长期目标
1. 支持更多文档格式
2. 重构为 TypeScript
3. 提供 API 接口
4. 支持插件系统 